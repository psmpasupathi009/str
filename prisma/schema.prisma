// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  email           String   @unique
  phoneNumber     String?
  name            String?
  password        String
  isEmailVerified Boolean  @default(false)
  role            Role     @default(USER)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("users")
}

model Otp {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  email     String
  code      String
  type      OTPType
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([email, type])
  @@map("otps")
}

enum Role {
  USER
  ADMIN
}

enum OTPType {
  SIGNUP
  FORGOT_PASSWORD
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum MediaType {
  IMAGE
  VIDEO
}

model Order {
  id                String        @id @default(auto()) @map("_id") @db.ObjectId
  userId            String?       @db.ObjectId
  razorpayOrderId   String        @unique
  razorpayPaymentId String?
  amount            Float
  currency          String        @default("INR")
  paymentStatus     PaymentStatus @default(PENDING)
  orderStatus       OrderStatus   @default(PENDING)
  items             OrderItem[]
  customerName      String?
  customerEmail     String?
  customerPhone     String?
  shippingAddress   Json?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@index([userId])
  @@map("orders")
}

model OrderItem {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  orderId     String @db.ObjectId
  productId   String
  productName String
  quantity    Int    @default(1)
  price       Float
  order       Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@map("order_items")
}

model Review {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  productId    String
  userId       String   @db.ObjectId
  userName     String
  userEmail    String
  rating       Int // 1-5 stars
  comment      String
  helpfulCount Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([productId])
  @@index([userId])
  @@map("reviews")
}

model ReviewHelpful {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  reviewId  String   @db.ObjectId
  userId    String   @db.ObjectId
  createdAt DateTime @default(now())

  @@unique([reviewId, userId])
  @@index([reviewId])
  @@map("review_helpful")
}

model ProductCategory {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  name        String    @unique
  description String?
  image       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]

  @@map("product_categories")
}

model Product {
  id          String          @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  categoryId  String          @db.ObjectId
  category    ProductCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  itemCode    String          @unique
  weight      String
  mrp         Float
  salePrice   Float
  gst         Float           @default(0.05)
  hsnCode     String
  image       String?
  images      String[]        @default([])
  description String?
  featured    Boolean         @default(false)
  bestSeller  Boolean         @default(false)
  inStock     Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([categoryId])
  @@index([name])
  @@index([featured])
  @@index([bestSeller])
  @@map("products")
}

model Gallery {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  url         String
  type        MediaType // IMAGE or VIDEO
  title       String?
  description String?
  order       Int       @default(0) // For ordering gallery items
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([order])
  @@index([type])
  @@map("gallery")
}
